From 368e4456a9be60d282bf2bbbd38b8483c5a62371 Mon Sep 17 00:00:00 2001
From: Hunsup Jung <hunsup.jung@samsung.com>
Date: Thu, 12 Sep 2024 09:47:50 +0900
Subject: [PATCH] Fix test file for microwave oven

Signed-off-by: Hunsup Jung <hunsup.jung@samsung.com>
---
 .../src/matter-microwave-oven/init.lua        |  2 +
 .../src/test/test_microwave_oven.lua          | 42 +++++++++++++++++++
 2 files changed, 44 insertions(+)

diff --git a/drivers/SmartThings/matter-appliance/src/matter-microwave-oven/init.lua b/drivers/SmartThings/matter-appliance/src/matter-microwave-oven/init.lua
index b183202b..db341c23 100644
--- a/drivers/SmartThings/matter-appliance/src/matter-microwave-oven/init.lua
+++ b/drivers/SmartThings/matter-appliance/src/matter-microwave-oven/init.lua
@@ -124,6 +124,8 @@ local function microwave_oven_supported_modes_handler(driver, device, ib, respon
   end
   local event = capabilities.mode.supportedModes(microwaveOvenModeSupportedModes, {visibility = {displayed = false}})
   device:emit_event_for_endpoint(device.MATTER_DEFAULT_ENDPOINT, event)
+  event = capabilities.mode.supportedArguments(microwaveOvenModeSupportedModes, {visibility = {displayed = false}})
+  device:emit_event_for_endpoint(device.MATTER_DEFAULT_ENDPOINT, event)
   device:set_field(MICROWAVE_OVEN_SUPPORTED_MODES_KEY, microwaveOvenModeSupportedModes)
 end
 
diff --git a/drivers/SmartThings/matter-appliance/src/test/test_microwave_oven.lua b/drivers/SmartThings/matter-appliance/src/test/test_microwave_oven.lua
index b7376251..bac55c95 100644
--- a/drivers/SmartThings/matter-appliance/src/test/test_microwave_oven.lua
+++ b/drivers/SmartThings/matter-appliance/src/test/test_microwave_oven.lua
@@ -99,6 +99,7 @@ local function init_supported_microwave_oven_modes()
     )
   })
   test.socket.capability:__expect_send(mock_device:generate_test_message("main", capabilities.mode.supportedModes({ "Grill", "Pre Heat" }, {visibility={displayed=false}})))
+  test.socket.capability:__expect_send(mock_device:generate_test_message("main", capabilities.mode.supportedArguments({ "Grill", "Pre Heat" }, {visibility={displayed=false}})))
 end
 
 test.set_test_init_function(test_init)
@@ -158,6 +159,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({},{visibility={displayed=false}}))
       -- Prevent user from changing modes in between an operation.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({},{visibility={displayed=false}}))
+      -- Prevent user from changing modes in between an operation.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -229,6 +236,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({ "Grill", "Pre Heat" },{visibility={displayed=false}}))
       --When operation is stopped, enable mode options for user to choose.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({ "Grill", "Pre Heat" },{visibility={displayed=false}}))
+      --When operation is stopped, enable mode options for user to choose.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -306,6 +319,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({},{visibility={displayed=false}}))
       -- Prevent user from changing modes in between an operation.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({},{visibility={displayed=false}}))
+      -- Prevent user from changing modes in between an operation.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -350,6 +369,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({},{visibility={displayed=false}}))
       -- Prevent user from changing mode in event of error.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({},{visibility={displayed=false}}))
+      -- Prevent user from changing mode in event of error.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -375,6 +400,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({},{visibility={displayed=false}}))
       -- Prevent user from changing mode in event of error.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({},{visibility={displayed=false}}))
+      -- Prevent user from changing mode in event of error.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -400,6 +431,12 @@ test.register_message_test(
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({},{visibility={displayed=false}}))
       -- Prevent user from changing mode in event of error.
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({},{visibility={displayed=false}}))
+      -- Prevent user from changing mode in event of error.
+    },
     {
       channel = "matter",
       direction = "receive",
@@ -485,6 +522,11 @@ test.register_message_test(
       direction = "send",
       message = mock_device:generate_test_message("main", capabilities.mode.supportedModes({ "Grill", "Pre Heat" }, {visibility={displayed=false}}))
     },
+    {
+      channel = "capability",
+      direction = "send",
+      message = mock_device:generate_test_message("main", capabilities.mode.supportedArguments({ "Grill", "Pre Heat" }, {visibility={displayed=false}}))
+    },
     {
       channel = "capability",
       direction = "receive",
-- 
2.39.3 (Apple Git-145)

